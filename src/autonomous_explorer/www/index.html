<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robot Control Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .status {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .status.connected {
            background: #d4edda;
            color: #155724;
        }

        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }

        .position-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }

        .position-display h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .coordinates {
            font-size: 1.5em;
            color: #333;
            font-weight: bold;
        }

        .control-section {
            margin-bottom: 30px;
        }

        .control-section h3 {
            color: #666;
            margin-bottom: 15px;
            text-align: center;
        }

        .coverage-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .coverage-controls button {
            flex: 1;
            padding: 15px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .start-btn {
            background: #28a745;
            color: white;
        }

        .start-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .stop-btn {
            background: #dc3545;
            color: white;
        }

        .stop-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .control-btn {
            padding: 20px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.empty {
            background: transparent;
            cursor: default;
        }

        .control-btn.empty:hover {
            transform: none;
            box-shadow: none;
        }

        .stop-btn-grid {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .log {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
        }

        .log-entry {
            padding: 5px;
            border-bottom: 1px solid #dee2e6;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .control-btn {
                padding: 15px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Robot Control Dashboard</h1>
        
        <div id="status" class="status disconnected">
            ‚ö†Ô∏è Disconnected
        </div>

        <div class="position-display">
            <h3>Current Position</h3>
            <div class="coordinates">
                X: <span id="posX">0.00</span> m | Y: <span id="posY">0.00</span> m
            </div>
        </div>

        <div class="control-section">
            <h3>Autonomous Coverage</h3>
            <div class="coverage-controls">
                <button class="start-btn" onclick="startCoverage()">‚ñ∂Ô∏è Start Coverage</button>
                <button class="stop-btn" onclick="stopCoverage()">‚èπÔ∏è Stop Coverage</button>
            </div>
        </div>

        <div class="control-section">
            <h3>Manual Control</h3>
            <div class="controls-grid">
                <div class="control-btn empty"></div>
                <button class="control-btn" onclick="sendCommand('forward')">‚¨ÜÔ∏è Forward</button>
                <div class="control-btn empty"></div>
                
                <button class="control-btn" onclick="sendCommand('left')">‚¨ÖÔ∏è Left</button>
                <button class="control-btn stop-btn-grid" onclick="sendCommand('stop')">‚èπÔ∏è Stop</button>
                <button class="control-btn" onclick="sendCommand('right')">‚û°Ô∏è Right</button>
                
                <div class="control-btn empty"></div>
                <button class="control-btn" onclick="sendCommand('backward')">‚¨áÔ∏è Backward</button>
                <div class="control-btn empty"></div>
            </div>
        </div>

        <div class="control-section">
            <h3>Activity Log</h3>
            <div id="log" class="log">
                <div class="log-entry">Waiting for connection...</div>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let reconnectInterval = null;

        function connect() {
            ws = new WebSocket('ws://localhost:8765');
            
            ws.onopen = () => {
                document.getElementById('status').className = 'status connected';
                document.getElementById('status').textContent = '‚úÖ Connected';
                addLog('Connected to robot');
                if (reconnectInterval) {
                    clearInterval(reconnectInterval);
                    reconnectInterval = null;
                }
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                if (data.type === 'position') {
                    document.getElementById('posX').textContent = data.x.toFixed(2);
                    document.getElementById('posY').textContent = data.y.toFixed(2);
                }
            };
            
            ws.onclose = () => {
                document.getElementById('status').className = 'status disconnected';
                document.getElementById('status').textContent = '‚ö†Ô∏è Disconnected';
                addLog('Disconnected from robot');
                
                if (!reconnectInterval) {
                    reconnectInterval = setInterval(() => {
                        addLog('Attempting to reconnect...');
                        connect();
                    }, 3000);
                }
            };
            
            ws.onerror = (error) => {
                addLog('Connection error');
            };
        }

        function sendCommand(command) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'command', command: command}));
                addLog(`Sent: ${command}`);
            } else {
                addLog('Error: Not connected');
            }
        }

        function startCoverage() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'coverage', action: 'start'}));
                addLog('Started autonomous coverage');
            } else {
                addLog('Error: Not connected');
            }
        }

        function stopCoverage() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({type: 'coverage', action: 'stop'}));
                addLog('Stopped autonomous coverage');
            } else {
                addLog('Error: Not connected');
            }
        }

        function addLog(message) {
            const log = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            log.insertBefore(entry, log.firstChild);
            
            // Keep only last 20 entries
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp':
                case 'w':
                    sendCommand('forward');
                    e.preventDefault();
                    break;
                case 'ArrowDown':
                case 's':
                    sendCommand('backward');
                    e.preventDefault();
                    break;
                case 'ArrowLeft':
                case 'a':
                    sendCommand('left');
                    e.preventDefault();
                    break;
                case 'ArrowRight':
                case 'd':
                    sendCommand('right');
                    e.preventDefault();
                    break;
                case ' ':
                    sendCommand('stop');
                    e.preventDefault();
                    break;
            }
        });

        // Connect on load
        connect();
    </script>
</body>
</html>